<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Matching Comparison Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f7f8fa 0%, #e4e7ec 100%);
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #1f2937;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #6b7280;
            font-size: 16px;
        }

        .setup-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .setup-section h2 {
            color: #1f2937;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .setup-column {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .setup-column h3 {
            color: #374151;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }

        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .input-group input[type="text"]:focus,
        .input-group input[type="password"]:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .input-group textarea {
            height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }

        .file-upload-area:hover {
            border-color: #2563eb;
            background: #f8fafc;
        }

        .file-upload-area.dragover {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .uploaded-files {
            margin-top: 12px;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .uploaded-file-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .uploaded-file-name {
            font-weight: 500;
            color: #374151;
        }

        .uploaded-file-size {
            color: #6b7280;
            font-size: 12px;
        }

        .remove-file {
            color: #dc2626;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .remove-file:hover {
            background: #fee2e2;
        }

        .button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button:hover {
            background: #1d4ed8;
        }

        .button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .button-secondary {
            background: #6b7280;
        }

        .button-secondary:hover {
            background: #4b5563;
        }

        .button-success {
            background: #059669;
        }

        .button-success:hover {
            background: #047857;
        }

        .results-section {
            margin-top: 24px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 24px;
        }

        .result-column {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result-column h3 {
            color: #1f2937;
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .system-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-extension {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-webapp {
            background: #dcfce7;
            color: #166534;
        }

        .badge-enhanced {
            background: #fef3c7;
            color: #92400e;
        }

        .job-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .job-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .job-card-header {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
        }

        .job-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .job-card-company {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .job-card-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
            color: #6b7280;
        }

        .match-score {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .match-score-value {
            font-size: 18px;
        }

        .match-grade {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .grade-excellent {
            background: #dcfce7;
            color: #166534;
        }

        .grade-good {
            background: #dbeafe;
            color: #1e40af;
        }

        .grade-moderate {
            background: #fef3c7;
            color: #92400e;
        }

        .grade-weak {
            background: #fecaca;
            color: #991b1b;
        }

        .grade-poor {
            background: #fee2e2;
            color: #991b1b;
        }

        .job-card-content {
            padding: 16px;
            display: none;
        }

        .job-card.expanded .job-card-content {
            display: block;
        }

        .analysis-section {
            margin-bottom: 16px;
        }

        .analysis-section h4 {
            color: #374151;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .analysis-list {
            list-style: none;
            padding: 0;
        }

        .analysis-list li {
            padding: 4px 0;
            color: #6b7280;
            font-size: 13px;
        }

        .analysis-list li::before {
            content: "‚Ä¢";
            color: #2563eb;
            margin-right: 8px;
        }

        .processing-time {
            color: #6b7280;
            font-size: 12px;
            font-style: italic;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .success {
            background: #dcfce7;
            color: #166534;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .status-bar {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #374151;
        }

        .comparison-summary {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .comparison-summary h3 {
            color: #1f2937;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #2563eb;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .resume-selector {
            margin-bottom: 16px;
        }

        .resume-selector select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 8px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #2563eb;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Resume Matching Comparison Test</h1>
            <p>Compare Extension vs Web App Resume Matching Logic Side-by-Side</p>
        </div>

        <div class="setup-section">
            <h2>Setup & Configuration</h2>
            <div class="setup-grid">
                <div class="setup-column">
                    <h3>üîß Configuration</h3>
                    <div class="input-group">
                        <label for="openai-api-key">OpenAI API Key</label>
                        <input type="password" id="openai-api-key" placeholder="sk-..." required>
                    </div>
                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="use-enhanced-matching"> Use Enhanced 22-Variable Matching
                            <span class="toggle-switch">
                                <input type="checkbox" id="enhanced-toggle">
                                <span class="toggle-slider"></span>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="setup-column">
                    <h3>üìÑ Upload Resumes</h3>
                    <div class="file-upload-area" id="resume-upload-area">
                        <input type="file" id="resume-files" multiple accept=".pdf,.doc,.docx,.txt">
                        <div class="upload-text">
                            <p>üìÅ Click to upload or drag & drop resumes</p>
                            <p style="font-size: 12px; color: #6b7280;">Supports PDF, DOC, DOCX, TXT files</p>
                        </div>
                    </div>
                    <button class="button" id="load-sample-resumes-btn" style="margin-top: 12px;">
                        <span>üìã</span> Load Sample Attorney Resumes
                    </button>
                    <div class="uploaded-files" id="uploaded-resumes"></div>
                </div>
            </div>
        </div>

        <div class="setup-section">
            <h2>Job Descriptions</h2>
            <div class="input-group">
                <label for="job-title">Job Title</label>
                <input type="text" id="job-title" placeholder="e.g., Senior Software Engineer">
            </div>
            <div class="input-group">
                <label for="job-company">Company</label>
                <input type="text" id="job-company" placeholder="e.g., TechCorp Inc.">
            </div>
            <div class="input-group">
                <label for="job-description">Job Description</label>
                <textarea id="job-description" placeholder="Paste job description here..."></textarea>
            </div>
            <button class="button" id="add-job-btn">
                <span>‚ûï</span> Add Job Description
            </button>
        </div>

        <div class="setup-section">
            <h2>Added Jobs</h2>
            <div id="added-jobs"></div>
            <button class="button button-success" id="run-comparison-btn" disabled>
                <span>üöÄ</span> Run Comparison
            </button>
            <button class="button button-secondary" id="export-results-btn" disabled style="margin-left: 16px;">
                <span>üìä</span> Export Results
            </button>
        </div>

        <div class="results-section" id="results-section" style="display: none;">
            <div class="comparison-summary" id="comparison-summary">
                <h3>Comparison Summary</h3>
                <div class="summary-stats" id="summary-stats"></div>
            </div>
            
            <div class="results-grid">
                <div class="result-column">
                    <h3>
                        <span class="system-badge badge-extension">Extension Logic</span>
                        Holistic AI Analysis
                    </h3>
                    <div id="extension-results"></div>
                </div>
                
                <div class="result-column">
                    <h3>
                        <span class="system-badge badge-webapp">Web App Logic</span>
                        Multi-Step Pipeline
                    </h3>
                    <div id="webapp-results"></div>
                </div>
                
                <div class="result-column" id="enhanced-column" style="display: none;">
                    <h3>
                        <span class="system-badge badge-enhanced">Enhanced Logic</span>
                        22-Variable Analysis
                    </h3>
                    <div id="enhanced-results"></div>
                </div>
            </div>
        </div>

        <div class="status-bar" id="status-bar" style="display: none;">
            <div class="loading">
                <div class="spinner"></div>
                <span id="status-text">Initializing...</span>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedResumes = [];
        let addedJobs = [];
        let comparisonResults = [];
        let isProcessing = false;

        // Pre-populated job descriptions for testing
        const defaultJobs = [
            {
                title: "Senior Corporate Attorney",
                company: "AmLaw 100 Firm",
                description: `We are seeking a Senior Corporate Attorney with 6+ years of experience to join our San Francisco office. The ideal candidate will have extensive experience in domestic and cross-border mergers and acquisitions (M&A), venture capital and private equity sponsored investments, and complex corporate finance transactions.

Key Responsibilities:
- Handle domestic and cross-border mergers and acquisitions (M&A)
- Advise on venture capital and private equity sponsored investments
- Manage secured transactions and complex corporate finance
- Provide guidance on emerging corporate governance issues
- Draft, review, and negotiate various corporate agreements
- Conduct legal research and analysis for complex transactions

Required Qualifications:
- JD from accredited law school with outstanding academic credentials
- 6+ years of corporate law experience at top-tier law firm
- Strong M&A and corporate finance background
- Experience with SEC reporting and compliance
- Excellent analytical, writing, and communication skills
- Ability to work in fast-paced, deadline-driven environment
- Bar admission in California (or ability to obtain)

Preferred Qualifications:
- Experience with international transactions
- Technology sector experience
- CPA or MBA preferred
- Mandarin or Spanish language skills a plus

Compensation: $390,000 - $450,000 + bonus + benefits`
            },
            {
                title: "Criminal Defense Attorney",
                company: "Metro Legal Defense Group",
                description: `Established criminal defense firm in New York seeking an experienced Criminal Defense Attorney to handle a diverse caseload of criminal matters. This position offers the opportunity to work on high-profile cases while making a meaningful impact on clients' lives.

Key Responsibilities:
- Represent clients in criminal proceedings from arraignment through trial
- Conduct client interviews and case investigations
- Negotiate plea agreements with prosecutors
- Prepare and present cases at trial
- Handle appeals and post-conviction matters
- Maintain detailed case files and documentation
- Collaborate with investigators, expert witnesses, and support staff

Required Qualifications:
- JD from accredited law school
- 3+ years of criminal defense experience
- Strong trial advocacy skills
- Experience with felony and misdemeanor cases
- Knowledge of criminal procedure and evidence rules
- Excellent oral and written communication skills
- NY State Bar admission required
- Clean disciplinary record

Preferred Qualifications:
- Experience with white-collar criminal defense
- Federal court experience
- Spanish language proficiency
- Previous prosecutor experience
- Knowledge of sentencing guidelines

Compensation: $85,000 - $120,000 + performance bonuses`
            },
            {
                title: "Personal Injury Attorney",
                company: "Westside Injury Law",
                description: `Growing personal injury law firm seeks an experienced Personal Injury Attorney to join our Los Angeles office. The successful candidate will manage a caseload of personal injury matters while working closely with our experienced team of attorneys and support staff.

Key Responsibilities:
- Handle personal injury cases from initial consultation through resolution
- Conduct client interviews and case evaluations
- Investigate accidents and gather evidence
- Negotiate settlements with insurance companies
- Prepare cases for trial and represent clients in court
- Draft legal documents including complaints, motions, and discovery requests
- Maintain regular communication with clients throughout case progression
- Collaborate with medical experts, accident reconstruction specialists, and investigators

Required Qualifications:
- JD from accredited law school
- 4+ years of personal injury litigation experience
- Strong negotiation and settlement skills
- Trial experience required
- Knowledge of California personal injury law
- Excellent written and verbal communication skills
- California State Bar admission in good standing
- Ability to handle large caseload efficiently

Preferred Qualifications:
- Experience with catastrophic injury cases
- Medical malpractice experience
- Bilingual (English/Spanish) preferred
- Previous insurance defense experience
- Experience with mass tort litigation

Compensation: $110,000 - $160,000 + contingency fee sharing`
            },
            {
                title: "Immigration Attorney",
                company: "Sunshine Immigration Services",
                description: `Boutique immigration law firm in Miami seeking a dedicated Immigration Attorney to join our growing practice. The ideal candidate will have experience with various immigration matters and a passion for helping clients navigate the complex immigration system.

Key Responsibilities:
- Handle diverse immigration matters including family-based petitions, employment-based applications, and deportation defense
- Prepare and file applications with USCIS, DOL, and immigration courts
- Represent clients in immigration court proceedings
- Conduct client consultations and case assessments
- Draft legal briefs, motions, and appellate documents
- Stay current on changing immigration laws and regulations
- Provide legal advice on compliance matters for corporate clients
- Mentor junior attorneys and paralegals

Required Qualifications:
- JD from accredited law school
- 3+ years of immigration law experience
- Experience with USCIS applications and procedures
- Immigration court experience preferred
- Strong research and writing skills
- Bilingual (English/Spanish) required
- Florida Bar admission (or ability to obtain)
- Compassionate approach to client service

Preferred Qualifications:
- Experience with business immigration matters
- Knowledge of asylum and refugee law
- Federal court experience
- Additional language skills (Portuguese, French, Haitian Creole)
- Experience with removal defense
- AILA membership

Compensation: $75,000 - $110,000 + benefits`
            },
            {
                title: "Family Law Attorney",
                company: "Chicago Family Legal Center",
                description: `Established family law practice seeks an experienced Family Law Attorney to join our Chicago office. The successful candidate will handle a variety of family law matters with sensitivity and professionalism while advocating zealously for our clients.

Key Responsibilities:
- Handle divorce, custody, and support matters
- Negotiate prenuptial and postnuptial agreements
- Represent clients in domestic violence proceedings
- Conduct depositions and court hearings
- Draft pleadings, motions, and settlement agreements
- Mediate family disputes when appropriate
- Collaborate with financial experts, custody evaluators, and therapists
- Maintain detailed case files and client communications

Required Qualifications:
- JD from accredited law school
- 5+ years of family law experience
- Strong courtroom advocacy skills
- Experience with complex financial matters in divorce
- Knowledge of Illinois family law statutes
- Excellent interpersonal and communication skills
- Illinois State Bar admission required
- Ability to handle emotionally charged situations with professionalism

Preferred Qualifications:
- Experience with high-net-worth divorce cases
- Collaborative law training
- Mediation certification
- Experience with international custody matters
- Knowledge of tax implications in family law
- Spanish language skills

Compensation: $95,000 - $140,000 + bonus potential`
            }
        ];

        // Sample attorney resumes for testing
        const sampleResumes = [
            {
                id: 1,
                name: "John_Smith_Corporate_Attorney.txt",
                size: 3250,
                type: "text/plain",
                content: `JOHN SMITH
Senior Corporate Attorney
Email: john.smith@email.com | Phone: (555) 123-4567
San Francisco, CA

PROFESSIONAL SUMMARY
Experienced corporate attorney with 8+ years specializing in mergers & acquisitions, venture capital, and complex corporate finance transactions. Strong background in securities law, corporate governance, and cross-border transactions. Proven track record of successfully closing deals worth over $2 billion.

EXPERIENCE

Senior Associate, Corporate Law | Wilson, Sonsini & Associates | 2019-Present
- Lead counsel on 25+ M&A transactions ranging from $50M to $500M
- Advised technology startups through Series A-C funding rounds
- Managed SEC reporting and compliance for public companies
- Drafted and negotiated complex corporate agreements and joint ventures
- Collaborated with international teams on cross-border transactions

Corporate Attorney | Morrison & Foerster | 2016-2019
- Supported senior partners on large-scale M&A deals
- Conducted due diligence for private equity and venture capital transactions
- Prepared SEC filings and proxy statements
- Advised on corporate governance matters for Fortune 500 companies

EDUCATION
J.D., Harvard Law School | 2016 | Magna Cum Laude
- Harvard Law Review, Editor
- Moot Court Competition, Semi-finalist

B.A., Economics | Stanford University | 2013 | Summa Cum Laude
- Phi Beta Kappa

BAR ADMISSIONS
California State Bar | 2016
New York State Bar | 2017

SKILLS
- M&A and Corporate Finance
- Securities Law and SEC Compliance
- Venture Capital and Private Equity
- Corporate Governance
- Contract Negotiation
- Cross-border Transactions
- Mandarin Chinese (Conversational)

CERTIFICATIONS
- Certified Public Accountant (CPA) | 2014`
            },
            {
                id: 2,
                name: "Sarah_Johnson_Criminal_Defense.txt",
                size: 2890,
                type: "text/plain",
                content: `SARAH JOHNSON
Criminal Defense Attorney
Email: sarah.johnson@email.com | Phone: (555) 987-6543
New York, NY

PROFESSIONAL SUMMARY
Dedicated criminal defense attorney with 5+ years of experience representing clients in state and federal courts. Skilled in trial advocacy, plea negotiations, and appellate work. Strong track record of achieving favorable outcomes for clients facing serious criminal charges.

EXPERIENCE

Criminal Defense Attorney | Johnson & Associates | 2020-Present
- Represent clients in felony and misdemeanor cases including DUI, drug offenses, and white-collar crimes
- Achieved 85% success rate in plea negotiations
- Conducted 15+ jury trials with 70% acquittal rate
- Handle post-conviction appeals and sentence modifications
- Collaborate with private investigators and expert witnesses

Assistant District Attorney | Manhattan District Attorney's Office | 2018-2020
- Prosecuted criminal cases from arraignment through trial
- Managed caseload of 150+ active cases
- Specialized in financial crimes and fraud cases
- Trained junior prosecutors on trial advocacy techniques
- Maintained 90% conviction rate

EDUCATION
J.D., New York University School of Law | 2018
- Criminal Law Journal, Staff Writer
- Legal Aid Society Clinic, Student Attorney

B.A., Political Science | Columbia University | 2015
- Dean's List all semesters

BAR ADMISSIONS
New York State Bar | 2018
U.S. District Court, Southern District of New York | 2019

SKILLS
- Trial Advocacy
- Criminal Procedure
- Evidence Law
- Plea Negotiations
- Appellate Brief Writing
- Client Counseling
- Spanish (Fluent)

NOTABLE CASES
- Successfully defended high-profile embezzlement case resulting in acquittal
- Achieved sentence reduction from 10 years to 3 years in federal drug case
- Won appeal overturning conviction for aggravated assault`
            },
            {
                id: 3,
                name: "Michael_Davis_Personal_Injury.txt",
                size: 3120,
                type: "text/plain",
                content: `MICHAEL DAVIS
Personal Injury Attorney
Email: michael.davis@email.com | Phone: (555) 456-7890
Los Angeles, CA

PROFESSIONAL SUMMARY
Experienced personal injury attorney with 6+ years representing accident victims and their families. Skilled in negotiating with insurance companies and trying cases before juries. Recovered over $15 million in settlements and verdicts for clients.

EXPERIENCE

Senior Associate | Davis & Partners Personal Injury Law | 2019-Present
- Handle complex personal injury cases including auto accidents, medical malpractice, and premises liability
- Negotiated $2.5M settlement for catastrophic injury case
- Achieved $1.8M jury verdict in wrongful death case
- Manage caseload of 75+ active cases
- Mentor junior attorneys and paralegals

Personal Injury Attorney | Miller & Associates | 2018-2019
- Represented clients in motor vehicle accidents and slip-and-fall cases
- Conducted mediations and settlement conferences
- Prepared cases for trial and handled jury selection
- Collaborated with medical experts and accident reconstruction specialists

Insurance Defense Attorney | Pacific Insurance Legal | 2017-2018
- Defended insurance companies in personal injury claims
- Gained valuable insight into insurance company tactics and strategies
- Handled depositions and discovery matters

EDUCATION
J.D., UCLA School of Law | 2017
- Trial Advocacy Competition, Finalist
- Street Law Clinic, Student Attorney

B.A., Psychology | University of Southern California | 2014
- Psychology Honor Society

BAR ADMISSIONS
California State Bar | 2017

SKILLS
- Personal Injury Litigation
- Medical Malpractice
- Premises Liability
- Insurance Law
- Trial Advocacy
- Settlement Negotiations
- Spanish (Conversational)

NOTABLE SETTLEMENTS
- $2.5M - Catastrophic brain injury from auto accident
- $1.8M - Wrongful death verdict
- $950K - Medical malpractice settlement
- $750K - Premises liability case`
            }
        ];

        // Resume file handling
        function setupResumeUpload() {
            const uploadArea = document.getElementById('resume-upload-area');
            const fileInput = document.getElementById('resume-files');
            const uploadedFilesDiv = document.getElementById('uploaded-resumes');

            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);

            function handleDragOver(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            }

            function handleDrop(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                processFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                processFiles(files);
            }

            async function processFiles(files) {
                for (const file of files) {
                    if (file.type.match(/^text\/|application\/(pdf|msword|vnd\.openxmlformats-officedocument\.wordprocessingml\.document)$/)) {
                        const resumeData = {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            file: file,
                            content: await readFileContent(file)
                        };
                        uploadedResumes.push(resumeData);
                        renderUploadedFiles();
                    } else {
                        alert(`Unsupported file type: ${file.name}`);
                    }
                }
            }

            function readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            }

            function renderUploadedFiles() {
                uploadedFilesDiv.innerHTML = uploadedResumes.map(resume => `
                    <div class="uploaded-file">
                        <div class="uploaded-file-info">
                            <span class="uploaded-file-name">${resume.name}</span>
                            <span class="uploaded-file-size">(${formatFileSize(resume.size)})</span>
                        </div>
                        <span class="remove-file" onclick="removeResume('${resume.id}')">‚úï</span>
                    </div>
                `).join('');
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            window.removeResume = function(id) {
                uploadedResumes = uploadedResumes.filter(resume => resume.id != id);
                renderUploadedFiles();
                updateRunButton();
            };
        }

        // Job description handling
        function setupJobHandling() {
            const addJobBtn = document.getElementById('add-job-btn');
            const addedJobsDiv = document.getElementById('added-jobs');

            addJobBtn.addEventListener('click', addJob);

            function addJob() {
                const title = document.getElementById('job-title').value.trim();
                const company = document.getElementById('job-company').value.trim();
                const description = document.getElementById('job-description').value.trim();

                if (!title || !company || !description) {
                    alert('Please fill in all job fields');
                    return;
                }

                const job = {
                    id: Date.now() + Math.random(),
                    title,
                    company,
                    description,
                    location: 'Remote', // Default
                    salary: 'Not specified',
                    source: 'Manual Entry',
                    capturedAt: new Date().toISOString()
                };

                addedJobs.push(job);
                renderAddedJobs();
                
                // Clear form
                document.getElementById('job-title').value = '';
                document.getElementById('job-company').value = '';
                document.getElementById('job-description').value = '';
                
                updateRunButton();
            }

            function renderAddedJobs() {
                addedJobsDiv.innerHTML = addedJobs.map(job => `
                    <div class="job-card">
                        <div class="job-card-header">
                            <div class="job-card-title">${job.title}</div>
                            <div class="job-card-company">${job.company}</div>
                            <div class="job-card-meta">
                                <span>${job.description.substring(0, 100)}...</span>
                                <button class="button button-secondary" onclick="removeJob('${job.id}')" style="margin-left: auto;">Remove</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            window.removeJob = function(id) {
                addedJobs = addedJobs.filter(job => job.id != id);
                renderAddedJobs();
                updateRunButton();
            };
        }



        // Extension matching logic (simplified from popup.js)
        class ExtensionMatcher {
            constructor(apiKey) {
                this.apiKey = apiKey;
            }

            async calculateJobMatch(job, resume) {
                const startTime = Date.now();
                
                try {
                    const truncatedResume = resume.content.length > 3000 ? 
                        resume.content.substring(0, 3000) + '...' : resume.content;
                    const truncatedJobDesc = job.description.length > 12000 ? 
                        job.description.substring(0, 12000) + '...' : job.description;

                    // EXACT PROMPT FROM ACTUAL EXTENSION (popup.js)
                    const matchPrompt = `
You are a strict ATS system that provides brutally honest job-resume matching scores. Be very discriminating and use the full 0-100 scale.

SCORING CRITERIA:
- 90-100: Perfect match - candidate exceeds ALL requirements
- 80-89: Excellent match - meets ALL requirements with some extras
- 70-79: Good match - meets MOST requirements with minor gaps
- 60-69: Moderate match - meets SOME requirements with notable gaps
- 50-59: Weak match - few requirements met, significant gaps
- 0-49: Poor match - fundamental misalignment, major gaps

JOB POSTING:
Title: ${job.title}
Company: ${job.company}
Description: ${truncatedJobDesc}
Location: ${job.location}
${job.salary ? `Salary: ${job.salary}` : ''}

RESUME:
${truncatedResume}

ANALYSIS INSTRUCTIONS:
1. Count specific technical skills mentioned in job vs resume
2. Evaluate years of experience required vs actual
3. Check for education/certification requirements
4. Look for industry/domain experience alignment
5. Assess seniority level match

Be harsh but fair. Don't give sympathy scores. If there are major gaps, reflect this in a low score. Most candidates should score below 70 unless they're truly exceptional matches. Use the full range from 0-100.

CRITICAL: You MUST respond with ONLY valid JSON. Do not include any text before or after the JSON. Do not use markdown formatting like \`\`\`json. Just return the raw JSON object.

Format response as JSON with matrix structure:
{
  "overallScore": 45,
  "strengths": ["Specific matching skills/experience found"],
  "gaps": ["Specific missing requirements"],
  "recommendations": ["Concrete actionable advice"],
  "reasoning": "Detailed explanation of score calculation",
  "matrix": [
    {
      "category": "Technical Skills",
      "requirement": "Python programming, 5+ years",
      "evidence": "Python developer with 3 years experience",
      "matchLevel": "partial",
      "gapAction": "Highlight advanced Python projects to demonstrate deeper expertise"
    },
    {
      "category": "Experience",
      "requirement": "Senior software development role",
      "evidence": "Senior Software Engineer at TechCorp",
      "matchLevel": "strong",
      "gapAction": "Major strength - emphasize leadership aspects"
    },
    {
      "category": "Education",
      "requirement": "Bachelor's degree in Computer Science",
      "evidence": "Master's degree in Computer Science",
      "matchLevel": "exceeds",
      "gapAction": "Exceeds requirement - highlight advanced coursework"
    }
  ]
}
`;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o',
                            messages: [
                                { role: 'system', content: matchPrompt }
                            ],
                            max_tokens: 1000,
                            temperature: 0.1
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`OpenAI API error: ${response.status}`);
                    }

                    const result = await response.json();
                    const content = result.choices[0].message.content;

                    // Parse JSON response
                    let cleanContent = content.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                    cleanContent = cleanContent.replace(/^```\s*/, '').replace(/\s*```$/, '');
                    
                    const matchResult = JSON.parse(cleanContent);
                    
                    // Add processing time
                    matchResult.processingTime = Date.now() - startTime;
                    matchResult.matchGrade = this.getMatchGrade(matchResult.overallScore);
                    matchResult.system = 'extension';
                    
                    return matchResult;
                } catch (error) {
                    console.error('Extension matching error:', error);
                    return {
                        overallScore: 0,
                        strengths: [],
                        gaps: ['Error processing match'],
                        recommendations: ['Please try again'],
                        reasoning: 'Processing error occurred',
                        matrix: [],
                        processingTime: Date.now() - startTime,
                        matchGrade: 'error',
                        system: 'extension',
                        error: error.message
                    };
                }
            }

            getMatchGrade(score) {
                if (score >= 85) return 'excellent';
                if (score >= 70) return 'good';
                if (score >= 55) return 'moderate';
                if (score >= 40) return 'weak';
                return 'poor';
            }
        }

        // Enhanced 22-Variable Matching System
        class EnhancedMatcher {
            constructor(apiKey) {
                this.apiKey = apiKey;
                this.model = 'gpt-4o';
                this.TOTAL_VARIABLES = 22;
                this.SIGNIFICANCE_THRESHOLD = 14;
                this.STRONG_EVIDENCE_THRESHOLD = 16;
                this.EXCELLENT_EVIDENCE_THRESHOLD = 18;
                
                this.CATEGORY_WEIGHTS = {
                    'critical_requirements': 0.40,
                    'core_competencies': 0.35,
                    'experience_factors': 0.15,
                    'preferred_qualifications': 0.10
                };
            }

            async fullMatchingAnalysis(jobDescription, jobTitle, company, resumeText) {
                const startTime = Date.now();
                
                try {
                    // Step 1: Extract job variables
                    const jobVariables = await this.extractJobVariables(jobDescription, jobTitle, company);
                    
                    // Step 2: Extract candidate variables
                    const candidateVariables = await this.extractCandidateVariables(resumeText);
                    
                    // Step 3: Create comparison
                    const comparisonResult = await this.createComparisonTable(jobVariables, candidateVariables);
                    
                    // Step 4: Calculate final metrics
                    const totalMatches = parseInt(comparisonResult.comparison_summary.total_matches.split(' ')[0]);
                    const matchPercentage = parseFloat(comparisonResult.comparison_summary.match_percentage);
                    
                    // Determine statistical significance
                    let confidenceLevel = 0.0;
                    let significanceLevel = "none";
                    
                    if (totalMatches >= this.EXCELLENT_EVIDENCE_THRESHOLD) {
                        confidenceLevel = 99.9;
                        significanceLevel = "excellent";
                    } else if (totalMatches >= this.STRONG_EVIDENCE_THRESHOLD) {
                        confidenceLevel = 99.0;
                        significanceLevel = "strong";
                    } else if (totalMatches >= this.SIGNIFICANCE_THRESHOLD) {
                        confidenceLevel = 95.0;
                        significanceLevel = "significant";
                    }
                    
                    // Calculate weighted total score
                    const categoryScores = {
                        critical_requirements: parseFloat(comparisonResult.detailed_comparison.critical_requirements.score),
                        core_competencies: parseFloat(comparisonResult.detailed_comparison.core_competencies.score),
                        experience_factors: parseFloat(comparisonResult.detailed_comparison.experience_factors.score),
                        preferred_qualifications: parseFloat(comparisonResult.detailed_comparison.preferred_qualifications.score)
                    };
                    
                    const totalScore = Object.keys(categoryScores).reduce((sum, category) => {
                        return sum + (categoryScores[category] * this.CATEGORY_WEIGHTS[category]);
                    }, 0);
                    
                    return {
                        overallScore: totalScore,
                        total_matches: totalMatches,
                        match_percentage: matchPercentage,
                        confidence_level: confidenceLevel,
                        significance_level: significanceLevel,
                        statistical_significance: totalMatches >= this.SIGNIFICANCE_THRESHOLD,
                        category_scores: categoryScores,
                        detailed_comparison: comparisonResult.detailed_comparison,
                        processingTime: Date.now() - startTime,
                        system: 'enhanced',
                        matchGrade: this.getMatchGrade(totalScore),
                        variables: this.formatVariables(comparisonResult.detailed_comparison)
                    };
                    
                } catch (error) {
                    console.error('Enhanced matching error:', error);
                    return {
                        overallScore: 0,
                        total_matches: 0,
                        match_percentage: 0,
                        confidence_level: 0,
                        significance_level: "none",
                        statistical_significance: false,
                        category_scores: {},
                        error: error.message,
                        processingTime: Date.now() - startTime,
                        system: 'enhanced',
                        matchGrade: 'error'
                    };
                }
            }

            async extractJobVariables(jobDescription, jobTitle, company) {
                // EXACT PROMPT FROM ACTUAL ENHANCED MATCHING SYSTEM (enhanced_matching_extension.js)
                const systemPrompt = `You are an expert HR analyst. Extract exactly 22 structured variables from job descriptions for systematic candidate matching.

CRITICAL INSTRUCTIONS:
1. Extract EXACTLY 22 variables distributed across 4 categories
2. Be specific and measurable
3. Focus on verifiable requirements
4. Include both explicit and implicit requirements

VARIABLE CATEGORIES:
- Critical Requirements (5 variables): Must-have qualifications
- Core Competencies (8 variables): Key skills and abilities
- Experience Factors (4 variables): Experience-related requirements
- Preferred Qualifications (5 variables): Nice-to-have qualifications`;

                const userPrompt = `
Analyze this job posting and extract exactly 22 variables for candidate matching:

JOB TITLE: ${jobTitle}
COMPANY: ${company}
JOB DESCRIPTION:
${jobDescription}

Extract variables in this exact JSON format:

{
  "job_analysis": {
    "title": "${jobTitle}",
    "company": "${company}",
    "industry": "detected industry",
    "seniority_level": "entry/mid/senior/executive",
    "job_type": "technical/business/creative/etc"
  },
  "critical_requirements": {
    "req_1": {
      "variable": "specific requirement name",
      "description": "detailed description",
      "evidence_needed": "what to look for in resume",
      "disqualifier": true
    },
    "req_2": { ... },
    "req_3": { ... },
    "req_4": { ... },
    "req_5": { ... }
  },
  "core_competencies": {
    "comp_1": {
      "variable": "skill/competency name",
      "description": "detailed description",
      "evidence_needed": "what to look for in resume",
      "proficiency_level": "beginner/intermediate/advanced/expert"
    },
    "comp_2": { ... },
    "comp_3": { ... },
    "comp_4": { ... },
    "comp_5": { ... },
    "comp_6": { ... },
    "comp_7": { ... },
    "comp_8": { ... }
  },
  "experience_factors": {
    "exp_1": {
      "variable": "experience requirement",
      "description": "detailed description",
      "evidence_needed": "what to look for in resume",
      "minimum_threshold": "specific measurement"
    },
    "exp_2": { ... },
    "exp_3": { ... },
    "exp_4": { ... }
  },
  "preferred_qualifications": {
    "pref_1": {
      "variable": "preferred qualification",
      "description": "detailed description", 
      "evidence_needed": "what to look for in resume",
      "bonus_value": "low/medium/high"
    },
    "pref_2": { ... },
    "pref_3": { ... },
    "pref_4": { ... },
    "pref_5": { ... }
  }
}

EXAMPLES of good variable extraction:
- "Bachelor's degree in Computer Science" ‚Üí specific, verifiable
- "5+ years Python development experience" ‚Üí measurable threshold
- "Experience with AWS cloud services" ‚Üí specific technology
- "Strong communication skills" ‚Üí general competency
- "Agile methodology experience" ‚Üí specific process knowledge

Ensure each variable is:
‚úì Specific and measurable
‚úì Verifiable from resume content
‚úì Relevant to job success
‚úì Distinct from other variables
`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: this.model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        max_tokens: 4000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`Job extraction failed: ${response.status}`);
                }

                const result = await response.json();
                const content = result.choices[0].message.content;
                const cleanContent = content.replace(/```json/g, '').replace(/```/g, '').trim();
                
                return JSON.parse(cleanContent);
            }

            async extractCandidateVariables(resumeText) {
                // EXACT PROMPT FROM ACTUAL ENHANCED MATCHING SYSTEM (enhanced_matching_extension.js)
                const systemPrompt = `You are an expert resume analyzer. Your task is to extract exactly 22 structured variables from candidate resumes that correspond to job requirements for systematic matching.

CRITICAL INSTRUCTIONS:
1. Extract EXACTLY 22 variables distributed across 4 categories
2. Base extraction on ACTUAL resume content only - don't invent information
3. Provide specific evidence from the resume for each variable
4. Rate proficiency/experience levels accurately
5. Include both explicit and inferred capabilities

VARIABLE CATEGORIES:
- Critical Requirements (5 variables): Educational background, certifications, licenses
- Core Competencies (8 variables): Technical skills, software proficiency, methodologies
- Experience Factors (4 variables): Years of experience, industry background, role progression
- Preferred Qualifications (5 variables): Additional skills, certifications, achievements

Return your analysis in the exact JSON format specified.`;

                const userPrompt = `
Analyze this candidate's resume and extract exactly 22 variables for job matching:

RESUME TEXT:
${resumeText}

STRUCTURED RESUME DATA:
${JSON.stringify({}, null, 2)}

Extract variables in this exact JSON format:

{
  "candidate_analysis": {
    "name": "candidate name",
    "years_total_experience": "calculated total years",
    "current_level": "entry/mid/senior/executive",
    "primary_expertise": "main area of expertise",
    "industry_background": "industry experience"
  },
  "critical_requirements": {
    "req_1": {
      "variable": "education/certification/license",
      "present": true/false,
      "evidence": "specific evidence from resume or 'Not found'",
      "details": "degree/certification details"
    },
    "req_2": { ... },
    "req_3": { ... },
    "req_4": { ... },
    "req_5": { ... }
  },
  "core_competencies": {
    "comp_1": {
      "variable": "technical skill/competency",
      "present": true/false,
      "evidence": "specific evidence from resume or 'Not found'",
      "proficiency_level": "beginner/intermediate/advanced/expert",
      "years_experience": "estimated years with this skill"
    },
    "comp_2": { ... },
    "comp_3": { ... },
    "comp_4": { ... },
    "comp_5": { ... },
    "comp_6": { ... },
    "comp_7": { ... },
    "comp_8": { ... }
  },
  "experience_factors": {
    "exp_1": {
      "variable": "experience type",
      "present": true/false,
      "evidence": "specific evidence from resume or 'Not found'",
      "measurement": "years/projects/companies/etc",
      "meets_threshold": true/false
    },
    "exp_2": { ... },
    "exp_3": { ... },
    "exp_4": { ... }
  },
  "preferred_qualifications": {
    "pref_1": {
      "variable": "additional qualification",
      "present": true/false,
      "evidence": "specific evidence from resume or 'Not found'",
      "value_level": "low/medium/high"
    },
    "pref_2": { ... },
    "pref_3": { ... },
    "pref_4": { ... },
    "pref_5": { ... }
  }
}

ANALYSIS GUIDELINES:
- Look for explicit mentions and reasonable inferences
- Consider job titles, responsibilities, and achievements
- Evaluate skill levels based on context and experience
- Provide specific evidence quotes when possible
- Be honest about missing qualifications
`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: this.model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        max_tokens: 4000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`Resume extraction failed: ${response.status}`);
                }

                const result = await response.json();
                const content = result.choices[0].message.content;
                const cleanContent = content.replace(/```json/g, '').replace(/```/g, '').trim();
                
                return JSON.parse(cleanContent);
            }

            async createComparisonTable(jobVariables, candidateVariables) {
                // EXACT PROMPT FROM ACTUAL ENHANCED MATCHING SYSTEM (enhanced_matching_extension.js)
                const systemPrompt = `You are an expert statistical analyst specializing in job-candidate matching. Your task is to create a detailed comparison table and calculate a statistically validated match score.

CRITICAL INSTRUCTIONS:
1. Compare exactly 22 variables systematically
2. Calculate precise match percentages for each category
3. Apply statistical significance testing
4. Provide evidence-based recommendations
5. Use standardized scoring methodology

SCORING METHODOLOGY:
- Critical Requirements: 40% total weight (8% each)
- Core Competencies: 35% total weight (4.375% each)
- Experience Factors: 15% total weight (3.75% each)
- Preferred Qualifications: 10% total weight (2% each)

STATISTICAL SIGNIFICANCE:
- 18-22 matches: Excellent evidence (99.9% confidence)
- 16-17 matches: Strong evidence (99.0% confidence)
- 14-15 matches: Significant evidence (95.0% confidence)
- <14 matches: Weak evidence (<95% confidence)

Return analysis in exact JSON format with statistical validation.`;

                const userPrompt = `
Compare these job requirements with candidate qualifications and create a detailed comparison table:

JOB REQUIREMENTS:
${JSON.stringify(jobVariables, null, 2)}

CANDIDATE QUALIFICATIONS:
${JSON.stringify(candidateVariables, null, 2)}

Create comparison in this exact JSON format:

{
  "comparison_summary": {
    "total_matches": "number of matches out of 22",
    "match_percentage": "percentage as decimal",
    "statistical_significance": "none/significant/strong/excellent",
    "confidence_level": "percentage",
    "overall_recommendation": "reject/weak_maybe/moderate_fit/strong_fit/excellent_fit"
  },
  "detailed_comparison": {
    "critical_requirements": {
      "matches": "number out of 5",
      "score": "weighted score",
      "details": [
        {
          "variable": "requirement name",
          "required": "job requirement",
          "candidate_has": "candidate evidence",
          "match": true/false,
          "impact": "high/medium/low",
          "notes": "explanation"
        }
      ]
    },
    "core_competencies": {
      "matches": "number out of 8",
      "score": "weighted score",
      "details": [
        {
          "variable": "competency name",
          "required_level": "job requirement level",
          "candidate_level": "candidate proficiency",
          "match": true/false,
          "gap_analysis": "explanation of gap if any",
          "notes": "additional context"
        }
      ]
    },
    "experience_factors": {
      "matches": "number out of 4",
      "score": "weighted score", 
      "details": [
        {
          "variable": "experience type",
          "required_threshold": "job requirement",
          "candidate_measurement": "candidate evidence",
          "meets_threshold": true/false,
          "notes": "explanation"
        }
      ]
    },
    "preferred_qualifications": {
      "matches": "number out of 5",
      "score": "weighted score",
      "details": [
        {
          "variable": "preferred qualification",
          "desired": "job preference",
          "candidate_has": "candidate evidence",
          "present": true/false,
          "value_added": "low/medium/high",
          "notes": "explanation"
        }
      ]
    }
  },
  "statistical_analysis": {
    "chi_square_test": {
      "statistic": "calculated chi-square value",
      "p_value": "statistical p-value",
      "significant": true/false
    },
    "effect_size": {
      "cohens_d": "calculated effect size",
      "interpretation": "small/medium/large/very_large"
    },
    "confidence_intervals": {
      "lower_bound": "95% CI lower bound",
      "upper_bound": "95% CI upper bound"
    }
  },
  "recommendations": {
    "hiring_decision": "strong_recommend/recommend/maybe/weak_maybe/reject",
    "missing_critical": ["list of missing critical requirements"],
    "development_areas": ["areas for candidate development"],
    "strengths": ["candidate strengths"],
    "next_steps": ["recommended actions"]
  }
}

ANALYSIS INSTRUCTIONS:
1. Compare each variable systematically
2. Calculate exact match counts for each category
3. Apply statistical tests for significance
4. Provide specific evidence for each decision
5. Include actionable recommendations
6. Be objective and data-driven in assessment
`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: this.model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ],
                        max_tokens: 4000,
                        temperature: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`Comparison failed: ${response.status}`);
                }

                const result = await response.json();
                const content = result.choices[0].message.content;
                const cleanContent = content.replace(/```json/g, '').replace(/```/g, '').trim();
                
                return JSON.parse(cleanContent);
            }

            formatVariables(detailedComparison) {
                const variables = [];
                
                Object.keys(detailedComparison).forEach(category => {
                    const categoryData = detailedComparison[category];
                    variables.push({
                        variable_name: category.replace(/_/g, ' ').toUpperCase(),
                        variable_score: parseFloat(categoryData.score) || 0
                    });
                });
                
                return variables;
            }

            getMatchGrade(score) {
                if (score >= 85) return 'excellent';
                if (score >= 70) return 'good';
                if (score >= 55) return 'moderate';
                if (score >= 40) return 'weak';
                return 'poor';
            }
        }

        // Web App matching logic (EXACT from actual web app)
        class WebAppMatcher {
            constructor(apiKey) {
                this.apiKey = apiKey;
                // EXACT GLOBAL_WEIGHTS from actual web app (prompts/resume_matcher.txt)
                this.GLOBAL_WEIGHTS = {
                    'Technical Skills': 28,
                    'Job Functions': 15,
                    'Experience Level': 18,
                    'Industry Experience': 10,
                    'Certifications': 7,
                    'Education Requirements': 7,
                    'Soft Skills': 5
                };
                this.CRIT_BONUS = {
                    'must_have': 1.0,
                    'strong_preference': 0.7,
                    'nice_to_have': 0.4
                };
                this.THRESHOLDS = {
                    micro_score_min_for_must_have: 0.70,
                    auto_pass_overall: 75
                };
            }

            async performMatching(jobDescription, jobTitle, company, resumeText) {
                const startTime = Date.now();
                
                try {
                    // Step 1: Extract job requirements (simplified for test)
                    const jobRequirements = await this.extractJobRequirements(jobDescription, jobTitle, company);
                    
                    // Step 2: Match resume using EXACT web app prompt
                    const matchResult = await this.matchResume(resumeText, jobRequirements);
                    
                    // Add processing time and metadata
                    matchResult.processingTime = Date.now() - startTime;
                    matchResult.system = 'webapp';
                    matchResult.matchGrade = this.getMatchGrade(matchResult.overall_weighted_score);
                    
                    return matchResult;
                    
                } catch (error) {
                    console.error('Web app matching error:', error);
                    return {
                        success: false,
                        variables: [],
                        overall_weighted_score: 0,
                        status: 'review',
                        error: error.message,
                        processingTime: Date.now() - startTime,
                        system: 'webapp',
                        matchGrade: 'error'
                    };
                }
            }

            async extractJobRequirements(jobDescription, jobTitle, company) {
                // Simplified job extraction (the actual web app has more complex extraction)
                const prompt = `Extract structured job requirements from this job description:

JOB TITLE: ${jobTitle}
COMPANY: ${company}
DESCRIPTION: ${jobDescription}

Return a JSON object with extracted requirements organized by variable type and criticality level.

{
  "variables": [
    {
      "variable_name": "Technical Skills",
      "requirements": [
        {
          "text": "Python programming",
          "criticality": "must_have",
          "weight": 28
        }
      ]
    }
  ]
}`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'system', content: prompt }],
                        max_tokens: 2000,
                        temperature: 0.3
                    })
                });

                if (!response.ok) {
                    throw new Error(`Job extraction failed: ${response.status}`);
                }

                const result = await response.json();
                const content = result.choices[0].message.content;
                let cleanContent = content.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                
                return JSON.parse(cleanContent);
            }

            addCharacterOffsets(text) {
                return text.split('\n').map((line, index) => {
                    const start = text.substring(0, text.indexOf(line));
                    return `${start.length}-${start.length + line.length}: ${line}`;
                }).join('\n');
            }

            async matchResume(resumeText, jobRequirements) {
                // EXACT PROMPT FROM ACTUAL WEB APP (prompts/resume_matcher.txt)
                const resumeWithOffsets = this.addCharacterOffsets(resumeText);
                
                const prompt = `SYSTEM
You are an HR match engine.

GLOBAL_WEIGHTS (sum = 90)  
Technical 28 ‚Ä¢ Job Functions 15 ‚Ä¢ Experience 18 ‚Ä¢ Industry 10 ‚Ä¢ Certifications 7  
Education 7 ‚Ä¢ Soft Skills 5   (Special Requirements are weighted by their own criticality)

THRESHOLDS  
micro_score_min_for_must_have = 0.70  
auto_pass_overall = 75

RULES
1. For every requirement in JD_REQUIREMENTS_JSON, search for EXACT EVIDENCE in the r√©sum√© text.  
2. ONLY return evidence that EXISTS VERBATIM in the r√©sum√©. DO NOT infer, assume, or create evidence.  
3. If you find exact text that matches the requirement:  
   - Copy the EXACT text from r√©sum√© as resume_evidence  
   - Provide the character offsets where this text appears  
   - Score based on how well the exact text matches the requirement (0.0-1.0)  
4. If you find NO exact evidence in the r√©sum√©:  
   - Set resume_evidence = ""  
   - Set offsets = ""  
   - Set match_score = 0.0  
5. NEVER make up or infer evidence. Only use text that actually exists in the r√©sum√©.  
6. requirement_points = weight √ó crit_bonus √ó match_score  
   ‚Äì crit_bonus = 1.0 (must_have), 0.7 (strong_preference), 0.4 (nice_to_have)  
7. Sum requirement_points inside each variable ‚Üí variable_score.  
8. Acceptance logic:  
   ‚Ä¢ If any must_have has match_score < 0.70 ‚áí status = "review".  
   ‚Ä¢ Else if overall_weighted_score ‚â• 75 ‚áí status = "autopass".  
   ‚Ä¢ Else ‚áí status = "review".

INPUT  
JD_REQUIREMENTS_JSON: ${JSON.stringify(jobRequirements, null, 2)}  
RESUME_TEXT_WITH_OFFSETS: |  
<<<  
${resumeWithOffsets}  
>>>

CRITICAL: resume_evidence must be EXACT text from the r√©sum√©. DO NOT create or infer evidence.

EXAMPLE - GOOD:
{
  "jd_text": "5+ years of software development experience required",
  "resume_evidence": "Senior Software Engineer with 7+ years of experience in web application development",
  "offsets": "180-245",
  "criticality": "must_have",
  "match_score": 0.9
}

EXAMPLE - BAD (DO NOT DO THIS):
{
  "jd_text": "5+ years of software development experience required",
  "resume_evidence": "Has extensive software development experience",  // ‚ùå NOT EXACT TEXT
  "offsets": "180-245",
  "criticality": "must_have",
  "match_score": 0.9
}

OUTPUT  
{
  "variables":[
    {
      "name":"Experience Level",
      "details":[
        {
          "jd_text":"<verbatim JD requirement>",
          "resume_evidence":"<EXACT text from r√©sum√© or empty string>",
          "offsets":"start-end positions or empty string",
          "criticality":"must_have",
          "match_score":0.93
        }
      ],
      "variable_score":16.7
    },
    ‚Ä¶ (7 more variable objects) ‚Ä¶
  ],
  "overall_weighted_score":80.2,
  "status":"autopass"
}`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'system', content: prompt }],
                        max_tokens: 3000,
                        temperature: 0.3
                    })
                });

                if (!response.ok) {
                    throw new Error(`Resume matching failed: ${response.status}`);
                }

                const result = await response.json();
                const content = result.choices[0].message.content;
                let cleanContent = content.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                
                return JSON.parse(cleanContent);
            }

            getMatchGrade(score) {
                if (score >= 85) return 'excellent';
                if (score >= 70) return 'good';
                if (score >= 55) return 'moderate';
                if (score >= 40) return 'weak';
                return 'poor';
            }
        }

        // Main comparison function
        async function runComparison() {
            if (isProcessing) return;
            
            isProcessing = true;
            const statusBar = document.getElementById('status-bar');
            const statusText = document.getElementById('status-text');
            const resultsSection = document.getElementById('results-section');
            const runBtn = document.getElementById('run-comparison-btn');
            
            statusBar.style.display = 'block';
            runBtn.disabled = true;
            
            try {
                const apiKey = document.getElementById('openai-api-key').value.trim();
                if (!apiKey) {
                    throw new Error('OpenAI API key is required');
                }

                const extensionMatcher = new ExtensionMatcher(apiKey);
                const webAppMatcher = new WebAppMatcher(apiKey);
                const useEnhanced = document.getElementById('use-enhanced-matching').checked;
                
                let enhancedMatcher;
                if (useEnhanced) {
                    enhancedMatcher = new EnhancedMatcher(apiKey);
                }
                
                const extensionResults = [];
                const webAppResults = [];
                const enhancedResults = [];
                
                let processedCount = 0;
                const totalOperations = uploadedResumes.length * addedJobs.length * (useEnhanced ? 3 : 2); // 2 or 3 systems
                
                // Process each resume against each job
                for (const resume of uploadedResumes) {
                    for (const job of addedJobs) {
                        statusText.textContent = `Processing ${resume.name} vs ${job.title}... (${processedCount + 1}/${totalOperations})`;
                        
                        // Extension matching
                        const extensionResult = await extensionMatcher.calculateJobMatch(job, resume);
                        extensionResults.push({
                            job,
                            resume,
                            result: extensionResult
                        });
                        processedCount++;
                        
                        statusText.textContent = `Processing ${resume.name} vs ${job.title}... (${processedCount + 1}/${totalOperations})`;
                        
                        // Web app matching
                        const webAppResult = await webAppMatcher.performMatching(
                            job.description, 
                            job.title, 
                            job.company, 
                            resume.content
                        );
                        webAppResults.push({
                            job,
                            resume,
                            result: webAppResult
                        });
                        processedCount++;
                        
                        // Enhanced matching (if enabled)
                        if (useEnhanced) {
                            statusText.textContent = `Processing ${resume.name} vs ${job.title} (Enhanced)... (${processedCount + 1}/${totalOperations})`;
                            
                            const enhancedResult = await enhancedMatcher.fullMatchingAnalysis(
                                job.description,
                                job.title,
                                job.company,
                                resume.content
                            );
                            enhancedResults.push({
                                job,
                                resume,
                                result: enhancedResult
                            });
                            processedCount++;
                        }
                        
                        // Add delay to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                // Store results
                comparisonResults = {
                    extension: extensionResults,
                    webapp: webAppResults,
                    enhanced: enhancedResults
                };
                
                // Show/hide enhanced column
                const enhancedColumn = document.getElementById('enhanced-column');
                if (useEnhanced) {
                    enhancedColumn.style.display = 'block';
                } else {
                    enhancedColumn.style.display = 'none';
                }
                
                // Render results
                renderResults();
                resultsSection.style.display = 'block';
                
                statusText.textContent = 'Comparison completed successfully!';
                setTimeout(() => {
                    statusBar.style.display = 'none';
                }, 3000);
                
                // Update button states
                updateRunButton();
                
            } catch (error) {
                console.error('Comparison error:', error);
                statusText.textContent = `Error: ${error.message}`;
                statusBar.style.backgroundColor = '#fee2e2';
                statusBar.style.color = '#991b1b';
            } finally {
                isProcessing = false;
                updateRunButton();
            }
        }

        // Render comparison results
        function renderResults() {
            renderSummary();
            renderSystemResults('extension', comparisonResults.extension);
            renderSystemResults('webapp', comparisonResults.webapp);
            if (comparisonResults.enhanced && comparisonResults.enhanced.length > 0) {
                renderSystemResults('enhanced', comparisonResults.enhanced);
            }
        }

        function renderSummary() {
            const summaryStats = document.getElementById('summary-stats');
            
            const extAvg = calculateAverageScore(comparisonResults.extension);
            const webAvg = calculateAverageScore(comparisonResults.webapp);
            const hasEnhanced = comparisonResults.enhanced && comparisonResults.enhanced.length > 0;
            const enhancedAvg = hasEnhanced ? calculateAverageScore(comparisonResults.enhanced) : 0;
            const totalTests = comparisonResults.extension.length;
            
            let statsHTML = `
                <div class="stat-item">
                    <div class="stat-value">${totalTests}</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${extAvg.toFixed(1)}%</div>
                    <div class="stat-label">Extension Avg</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${webAvg.toFixed(1)}%</div>
                    <div class="stat-label">Web App Avg</div>
                </div>
            `;
            
            if (hasEnhanced) {
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-value">${enhancedAvg.toFixed(1)}%</div>
                        <div class="stat-label">Enhanced Avg</div>
                    </div>
                `;
            }
            
            statsHTML += `
                <div class="stat-item">
                    <div class="stat-value">${Math.abs(extAvg - webAvg).toFixed(1)}%</div>
                    <div class="stat-label">Ext vs Web Diff</div>
                </div>
            `;
            
            if (hasEnhanced) {
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-value">${Math.abs(extAvg - enhancedAvg).toFixed(1)}%</div>
                        <div class="stat-label">Ext vs Enhanced Diff</div>
                    </div>
                `;
            }
            
            summaryStats.innerHTML = statsHTML;
        }

        function calculateAverageScore(results) {
            if (results.length === 0) return 0;
            const sum = results.reduce((acc, result) => {
                const score = result.result.overallScore || result.result.overall_weighted_score || 0;
                return acc + score;
            }, 0);
            return sum / results.length;
        }

        function renderSystemResults(system, results) {
            let containerId;
            if (system === 'extension') {
                containerId = 'extension-results';
            } else if (system === 'webapp') {
                containerId = 'webapp-results';
            } else if (system === 'enhanced') {
                containerId = 'enhanced-results';
            }
            const container = document.getElementById(containerId);
            
            container.innerHTML = results.map(item => {
                const result = item.result;
                const score = result.overallScore || result.overall_weighted_score || 0;
                const matchGrade = result.matchGrade || 'unscored';
                
                return `
                    <div class="job-card" onclick="toggleJobCard(this)">
                        <div class="job-card-header">
                            <div class="job-card-title">${item.job.title}</div>
                            <div class="job-card-company">${item.job.company}</div>
                            <div class="job-card-meta">
                                <div class="match-score">
                                    <span class="match-score-value">${score.toFixed(1)}%</span>
                                    <span class="match-grade grade-${matchGrade}">${matchGrade.toUpperCase()}</span>
                                </div>
                                <div class="processing-time">
                                    ${result.processingTime ? `${result.processingTime}ms` : 'N/A'}
                                </div>
                            </div>
                        </div>
                        <div class="job-card-content">
                            <div class="analysis-section">
                                <h4>üìÑ Resume: ${item.resume.name}</h4>
                            </div>
                            
                            ${result.strengths ? `
                                <div class="analysis-section">
                                    <h4>‚úÖ Strengths</h4>
                                    <ul class="analysis-list">
                                        ${result.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.gaps ? `
                                <div class="analysis-section">
                                    <h4>‚ùå Gaps</h4>
                                    <ul class="analysis-list">
                                        ${result.gaps.map(gap => `<li>${gap}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.recommendations ? `
                                <div class="analysis-section">
                                    <h4>üí° Recommendations</h4>
                                    <ul class="analysis-list">
                                        ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.variables ? `
                                <div class="analysis-section">
                                    <h4>üîç Variable Analysis</h4>
                                    <ul class="analysis-list">
                                        ${result.variables.map(variable => `
                                            <li><strong>${variable.variable_name}:</strong> ${variable.variable_score}%</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.reasoning ? `
                                <div class="analysis-section">
                                    <h4>üí≠ Reasoning</h4>
                                    <p style="font-size: 13px; color: #6b7280; font-style: italic;">${result.reasoning}</p>
                                </div>
                            ` : ''}
                            
                            ${result.total_matches ? `
                                <div class="analysis-section">
                                    <h4>üìä Statistical Analysis</h4>
                                    <ul class="analysis-list">
                                        <li><strong>Total Matches:</strong> ${result.total_matches}/22 (${(result.match_percentage * 100).toFixed(1)}%)</li>
                                        <li><strong>Confidence Level:</strong> ${result.confidence_level}%</li>
                                        <li><strong>Significance:</strong> ${result.significance_level}</li>
                                        <li><strong>Statistically Significant:</strong> ${result.statistical_significance ? 'Yes' : 'No'}</li>
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.category_scores ? `
                                <div class="analysis-section">
                                    <h4>üìà Category Scores</h4>
                                    <ul class="analysis-list">
                                        ${Object.entries(result.category_scores).map(([category, score]) => `
                                            <li><strong>${category.replace(/_/g, ' ')}:</strong> ${score.toFixed(1)}%</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${result.error ? `
                                <div class="error">
                                    <strong>Error:</strong> ${result.error}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleJobCard(card) {
            card.classList.toggle('expanded');
        }

        function updateEnhancedVisibility() {
            const enhancedColumn = document.getElementById('enhanced-column');
            const isEnhanced = document.getElementById('use-enhanced-matching').checked;
            
            if (isEnhanced) {
                enhancedColumn.style.display = 'block';
            } else {
                enhancedColumn.style.display = 'none';
            }
        }

        // Initialize the application
        function init() {
            setupResumeUpload();
            setupJobHandling();
            
            // Load default job descriptions
            console.log('Loading default job descriptions...');
            addedJobs = [...defaultJobs];
            renderJobList();
            
            // Load sample resumes automatically
            console.log('Loading sample attorney resumes...');
            loadSampleResumes();
            
            // Load sample resumes button
            document.getElementById('load-sample-resumes-btn').addEventListener('click', loadSampleResumes);
            
            // Run comparison button
            document.getElementById('run-comparison-btn').addEventListener('click', runComparison);
            
            // Export results button
            document.getElementById('export-results-btn').addEventListener('click', showExportMenu);
            
            // Enhanced matching toggle
            const enhancedToggle = document.getElementById('enhanced-toggle');
            const enhancedCheckbox = document.getElementById('use-enhanced-matching');
            
            enhancedToggle.addEventListener('change', function() {
                enhancedCheckbox.checked = this.checked;
                updateEnhancedVisibility();
            });
            
            enhancedCheckbox.addEventListener('change', function() {
                enhancedToggle.checked = this.checked;
                updateEnhancedVisibility();
            });
            
            updateRunButton();
        }

        // Load sample resumes function
        function loadSampleResumes() {
            console.log('Loading sample attorney resumes...');
            uploadedResumes = sampleResumes.map(resume => ({
                id: resume.id,
                name: resume.name,
                size: resume.size,
                type: resume.type,
                content: resume.content
            }));
            renderUploadedResumes();
            updateRunButton();
        }

        // Export functionality
        function exportResults() {
            if (!comparisonResults || Object.keys(comparisonResults).length === 0) {
                alert('No results to export. Please run a comparison first.');
                return;
            }

            const exportData = {
                timestamp: new Date().toISOString(),
                resumes: uploadedResumes.map(r => ({ name: r.name, size: r.size, type: r.type })),
                jobs: addedJobs.map(j => ({ title: j.title, company: j.company })),
                results: comparisonResults
            };

            // Create downloadable JSON file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `resume-matching-comparison-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function exportResultsAsCSV() {
            if (!comparisonResults || Object.keys(comparisonResults).length === 0) {
                alert('No results to export. Please run a comparison first.');
                return;
            }

            const csvRows = [];
            
            // Header
            const headers = ['Resume', 'Job Title', 'Company', 'Extension Score', 'Extension Grade', 'Extension Time', 'WebApp Score', 'WebApp Grade', 'WebApp Time'];
            if (comparisonResults.enhanced && comparisonResults.enhanced.length > 0) {
                headers.push('Enhanced Score', 'Enhanced Grade', 'Enhanced Time', 'Enhanced Matches', 'Enhanced Confidence', 'Enhanced Significance');
            }
            csvRows.push(headers.join(','));
            
            // Data rows
            const maxLength = Math.max(
                comparisonResults.extension.length,
                comparisonResults.webapp.length,
                comparisonResults.enhanced ? comparisonResults.enhanced.length : 0
            );
            
            for (let i = 0; i < maxLength; i++) {
                const extResult = comparisonResults.extension[i];
                const webResult = comparisonResults.webapp[i];
                const enhResult = comparisonResults.enhanced ? comparisonResults.enhanced[i] : null;
                
                const row = [
                    extResult ? `"${extResult.resume.name}"` : '',
                    extResult ? `"${extResult.job.title}"` : '',
                    extResult ? `"${extResult.job.company}"` : '',
                    extResult ? (extResult.result.overallScore || 0).toFixed(1) : '',
                    extResult ? `"${extResult.result.matchGrade}"` : '',
                    extResult ? extResult.result.processingTime : '',
                    webResult ? (webResult.result.overall_weighted_score || 0).toFixed(1) : '',
                    webResult ? `"${webResult.result.matchGrade}"` : '',
                    webResult ? webResult.result.processingTime : ''
                ];
                
                if (enhResult) {
                    row.push(
                        (enhResult.result.overallScore || 0).toFixed(1),
                        `"${enhResult.result.matchGrade}"`,
                        enhResult.result.processingTime,
                        enhResult.result.total_matches || 0,
                        enhResult.result.confidence_level || 0,
                        `"${enhResult.result.significance_level}"`
                    );
                }
                
                csvRows.push(row.join(','));
            }
            
            const csvContent = csvRows.join('\n');
            const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
            
            const exportFileDefaultName = `resume-matching-comparison-${new Date().toISOString().split('T')[0]}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function showExportMenu() {
            const menu = document.createElement('div');
            menu.className = 'export-menu';
            menu.innerHTML = `
                <div class="export-menu-content">
                    <h3>Export Results</h3>
                    <button class="button" onclick="exportResults(); closeExportMenu();">
                        <span>üìÑ</span> Export as JSON
                    </button>
                    <button class="button" onclick="exportResultsAsCSV(); closeExportMenu();">
                        <span>üìä</span> Export as CSV
                    </button>
                    <button class="button button-secondary" onclick="closeExportMenu();">
                        Cancel
                    </button>
                </div>
            `;
            
            menu.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const content = menu.querySelector('.export-menu-content');
            content.style.cssText = `
                background: white;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
                text-align: center;
            `;
            
            document.body.appendChild(menu);
            
            window.closeExportMenu = function() {
                document.body.removeChild(menu);
            };
        }

        // Update run button state
        function updateRunButton() {
            const runBtn = document.getElementById('run-comparison-btn');
            const exportBtn = document.getElementById('export-results-btn');
            const canRun = uploadedResumes.length > 0 && addedJobs.length > 0 && !isProcessing;
            const hasResults = comparisonResults && Object.keys(comparisonResults).length > 0;
            
            runBtn.disabled = !canRun;
            exportBtn.disabled = !hasResults;
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 