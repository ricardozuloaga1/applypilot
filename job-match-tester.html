<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Job Match Tester</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .match-score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .score-excellent { background: #d4edda; color: #155724; }
        .score-good { background: #cce5ff; color: #004085; }
        .score-moderate { background: #fff3cd; color: #856404; }
        .score-weak { background: #f8d7da; color: #721c24; }
        .score-poor { background: #f8d7da; color: #721c24; }
        .config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .config label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .sample-data {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .sample-data button {
            background: #6c757d;
            font-size: 12px;
            padding: 5px 10px;
            margin: 2px;
        }
        
        /* Matrix Styles */
        .analysis-matrix {
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .analysis-matrix h4 {
            margin: 0;
            padding: 16px 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .matrix-table {
            overflow-x: auto;
        }
        
        .matrix-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .matrix-table th {
            background: #f8fafc;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }
        
        .matrix-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: top;
            line-height: 1.4;
        }
        
        .matrix-table tr:hover {
            background: #f9fafb;
        }
        
        .matrix-category {
            font-weight: 600;
            color: #374151;
            max-width: 100px;
        }
        
        .matrix-requirement {
            color: #6b7280;
            max-width: 200px;
        }
        
        .matrix-evidence {
            color: #374151;
            max-width: 200px;
        }
        
        .matrix-match {
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            padding: 8px;
            border-radius: 6px;
            font-size: 11px;
        }
        
        .match-strong {
            background: rgba(34, 197, 94, 0.15);
            color: #15803d;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .match-exceeds {
            background: rgba(59, 130, 246, 0.15);
            color: #1d4ed8;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .match-partial {
            background: rgba(251, 191, 36, 0.15);
            color: #d97706;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .match-missing {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .matrix-action {
            color: #6b7280;
            font-style: italic;
            max-width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Job Match Tester</h1>
        <p>Test the AI-powered job matching functionality before integrating into the main extension.</p>
        
        <div class="config">
            <label for="api-key">OpenAI API Key:</label>
            <input type="password" id="api-key" placeholder="sk-...">
            <small>‚ö†Ô∏è This will be used to test the AI matching. Keep it secure!</small>
        </div>

        <div class="section">
            <h3>üìÑ Resume Content</h3>
            <div class="sample-data">
                <strong>Sample Data:</strong>
                <button onclick="loadSampleResume()">Load Sample Resume</button>
            </div>
            <textarea id="resume-content" placeholder="Paste your resume content here..."></textarea>
        </div>

        <div class="section">
            <h3>üíº Job Details</h3>
            <div class="sample-data">
                <strong>Sample Jobs:</strong>
                <button onclick="loadSampleJob('frontend')">Frontend Developer</button>
                <button onclick="loadSampleJob('backend')">Backend Developer</button>
                <button onclick="loadSampleJob('designer')">UI/UX Designer</button>
            </div>
            <label>Job Title:</label>
            <input type="text" id="job-title" placeholder="Senior Frontend Developer">
            
            <label>Company:</label>
            <input type="text" id="job-company" placeholder="Tech Company Inc.">
            
            <label>Job Description:</label>
            <textarea id="job-description" placeholder="Paste job description here..."></textarea>
        </div>

        <div class="section">
            <h3>üî¨ Test Configuration</h3>
            <label>
                <input type="checkbox" id="use-gpt4" checked> Use GPT-4 (more accurate but expensive)
            </label>
            <label>
                <input type="checkbox" id="detailed-analysis" checked> Get detailed analysis
            </label>
            <label>
                <input type="checkbox" id="show-prompt" checked> Show AI prompt in results
            </label>
        </div>

        <button onclick="runMatchTest()" id="test-btn">üöÄ Test Job Match</button>
        
        <div id="results"></div>
    </div>

    <script>
        // Sample data for testing
        const sampleResume = `John Doe
Senior Software Engineer
Email: john.doe@email.com | Phone: (555) 123-4567

EXPERIENCE:
‚Ä¢ 5+ years developing web applications using JavaScript, React, and Node.js
‚Ä¢ Led frontend development for 3 major product launches
‚Ä¢ Experience with modern frameworks: React, Vue.js, Angular
‚Ä¢ Strong background in responsive design and user experience
‚Ä¢ Proficient in TypeScript, HTML5, CSS3, and modern build tools
‚Ä¢ Experience with cloud platforms (AWS, Azure) and CI/CD pipelines
‚Ä¢ Led team of 4 developers on agile projects

SKILLS:
‚Ä¢ Frontend: React, Vue.js, TypeScript, HTML5, CSS3, Tailwind CSS
‚Ä¢ Backend: Node.js, Express, Python, REST APIs
‚Ä¢ Database: MongoDB, PostgreSQL, Redis
‚Ä¢ Tools: Git, Docker, Jenkins, Webpack, Vite
‚Ä¢ Cloud: AWS (EC2, S3, Lambda), Azure, Google Cloud Platform

EDUCATION:
‚Ä¢ Bachelor of Science in Computer Science - University of Technology (2018)`;

        const sampleJobs = {
            frontend: {
                title: "Senior Frontend Developer",
                company: "TechCorp Inc.",
                description: `We are seeking a Senior Frontend Developer to join our growing team. 

REQUIREMENTS:
‚Ä¢ 4+ years of experience with React and modern JavaScript
‚Ä¢ Strong proficiency in TypeScript and modern CSS
‚Ä¢ Experience with state management libraries (Redux, Zustand)
‚Ä¢ Familiarity with testing frameworks (Jest, React Testing Library)
‚Ä¢ Experience with build tools and deployment pipelines
‚Ä¢ Strong problem-solving skills and attention to detail
‚Ä¢ Experience working in agile development environments

RESPONSIBILITIES:
‚Ä¢ Develop and maintain high-quality React applications
‚Ä¢ Collaborate with design team to implement pixel-perfect UI
‚Ä¢ Optimize applications for performance and scalability
‚Ä¢ Mentor junior developers and contribute to code reviews
‚Ä¢ Work closely with backend developers to integrate APIs

NICE TO HAVE:
‚Ä¢ Experience with Next.js or similar React frameworks
‚Ä¢ Knowledge of mobile development (React Native)
‚Ä¢ Experience with cloud platforms (AWS, Azure)
‚Ä¢ Understanding of accessibility best practices`
            },
            backend: {
                title: "Backend Engineer",
                company: "DataTech Solutions",
                description: `Looking for a Backend Engineer to build scalable server-side applications.

REQUIREMENTS:
‚Ä¢ 3+ years of experience with Node.js and Python
‚Ä¢ Strong database design skills (PostgreSQL, MongoDB)
‚Ä¢ Experience with microservices architecture
‚Ä¢ Knowledge of containerization (Docker, Kubernetes)
‚Ä¢ Experience with cloud platforms (AWS, GCP)
‚Ä¢ Understanding of security best practices
‚Ä¢ Experience with API design and development

RESPONSIBILITIES:
‚Ä¢ Design and develop RESTful APIs and microservices
‚Ä¢ Implement database schemas and optimize queries
‚Ä¢ Build scalable and secure backend systems
‚Ä¢ Collaborate with frontend developers on API integration
‚Ä¢ Participate in system architecture discussions

PREFERRED:
‚Ä¢ Experience with message queues (RabbitMQ, Kafka)
‚Ä¢ Knowledge of DevOps practices and CI/CD
‚Ä¢ Experience with monitoring and logging tools
‚Ä¢ Understanding of distributed systems concepts`
            },
            designer: {
                title: "Senior UI/UX Designer",
                company: "Creative Studios",
                description: `We're looking for a Senior UI/UX Designer to create exceptional user experiences.

REQUIREMENTS:
‚Ä¢ 5+ years of UI/UX design experience
‚Ä¢ Proficiency in design tools (Figma, Sketch, Adobe Creative Suite)
‚Ä¢ Strong portfolio demonstrating web and mobile design
‚Ä¢ Experience with user research and usability testing
‚Ä¢ Understanding of design systems and component libraries
‚Ä¢ Knowledge of HTML/CSS and basic frontend development
‚Ä¢ Experience with prototyping and wireframing

RESPONSIBILITIES:
‚Ä¢ Create user-centered designs for web and mobile applications
‚Ä¢ Conduct user research and analyze user behavior
‚Ä¢ Develop wireframes, prototypes, and high-fidelity mockups
‚Ä¢ Collaborate with developers to ensure design implementation
‚Ä¢ Maintain and evolve design systems and style guides

PREFERRED:
‚Ä¢ Experience with motion design and micro-interactions
‚Ä¢ Knowledge of accessibility guidelines (WCAG)
‚Ä¢ Experience with A/B testing and conversion optimization
‚Ä¢ Understanding of brand design and marketing principles`
            }
        };

        function loadSampleResume() {
            document.getElementById('resume-content').value = sampleResume;
        }

        function loadSampleJob(type) {
            const job = sampleJobs[type];
            document.getElementById('job-title').value = job.title;
            document.getElementById('job-company').value = job.company;
            document.getElementById('job-description').value = job.description;
        }

        async function runMatchTest() {
            const apiKey = document.getElementById('api-key').value;
            const resumeContent = document.getElementById('resume-content').value;
            const jobTitle = document.getElementById('job-title').value;
            const jobCompany = document.getElementById('job-company').value;
            const jobDescription = document.getElementById('job-description').value;
            
            const useGPT4 = document.getElementById('use-gpt4').checked;
            const detailedAnalysis = document.getElementById('detailed-analysis').checked;
            const showPrompt = document.getElementById('show-prompt').checked;
            
            const resultsDiv = document.getElementById('results');
            const testBtn = document.getElementById('test-btn');
            
            // Validation
            if (!apiKey) {
                showResult('Please enter your OpenAI API key', 'error');
                return;
            }
            
            if (!resumeContent || !jobTitle || !jobDescription) {
                showResult('Please fill in all required fields', 'error');
                return;
            }
            
            testBtn.disabled = true;
            testBtn.textContent = 'üîÑ Testing...';
            
            try {
                const matchData = await calculateJobMatch({
                    title: jobTitle,
                    company: jobCompany,
                    description: jobDescription
                }, resumeContent, apiKey, useGPT4, detailedAnalysis, showPrompt);
                
                displayMatchResult(matchData);
                
            } catch (error) {
                showResult(`Error: ${error.message}`, 'error');
                console.error('Match test error:', error);
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'üöÄ Test Job Match';
            }
        }

        async function calculateJobMatch(job, resumeText, apiKey, useGPT4, detailedAnalysis, showPrompt) {
            const matchPrompt = `You are an expert career counselor and ATS system. Analyze how well this resume matches the job requirements.

JOB POSTING:
Title: ${job.title}
Company: ${job.company}
Description: ${job.description}

RESUME:
${resumeText}

Create a Requirements vs Evidence Matrix analysis. Break down job requirements by category and match them with resume evidence.

Format response as JSON with matrix structure:
{
  "overallScore": 85,
  "reasoning": "Strong technical match with minor gaps in leadership",
  "strengths": ["5+ years Python experience", "Strong React background"],
  "gaps": ["No AWS certification", "Limited team leadership"],
  "recommendations": ["Highlight cloud experience", "Emphasize collaborative projects"],
  "matrix": [
    {
      "category": "Technical Skills",
      "requirement": "5+ years Python experience",
      "evidence": "5+ years developing web applications using Python",
      "matchLevel": "strong",
      "gapAction": ""
    },
    {
      "category": "Leadership",
      "requirement": "Team leadership experience",
      "evidence": "Not mentioned",
      "matchLevel": "missing",
      "gapAction": "Add examples of leading projects or mentoring"
    }
  ]
}

Use these match levels: "strong", "exceeds", "partial", "missing"`;

            const model = useGPT4 ? 'gpt-4' : 'gpt-3.5-turbo';
            const startTime = Date.now();
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an expert ATS system and career counselor. Provide accurate, detailed job-resume match analysis in valid JSON format.'
                        },
                        {
                            role: 'user',
                            content: matchPrompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.3
                })
            });

            const responseTime = Date.now() - startTime;

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || `API Error: ${response.status}`);
            }

            const result = await response.json();
            const content = result.choices[0].message.content;
            
            // Calculate estimated cost
            const estimatedCost = useGPT4 ? 
                (result.usage.prompt_tokens * 0.03 + result.usage.completion_tokens * 0.06) / 1000 :
                (result.usage.prompt_tokens * 0.0015 + result.usage.completion_tokens * 0.002) / 1000;
            
            let matchData;
            try {
                matchData = JSON.parse(content);
            } catch (parseError) {
                // Fallback: extract score from text
                const scoreMatch = content.match(/(\d+)/);
                const score = scoreMatch ? parseInt(scoreMatch[1]) : 50;
                matchData = {
                    overallScore: score,
                    strengths: [],
                    gaps: [],
                    recommendations: [],
                    reasoning: content
                };
            }
            
            return {
                score: Math.max(0, Math.min(100, matchData.overallScore || 0)),
                strengths: matchData.strengths || [],
                gaps: matchData.gaps || [],
                recommendations: matchData.recommendations || [],
                reasoning: matchData.reasoning || '',
                matrix: matchData.matrix || [],
                analyzedAt: new Date().toISOString(),
                // Test metadata
                model: model,
                responseTime: responseTime,
                estimatedCost: estimatedCost.toFixed(4),
                usage: result.usage,
                rawResponse: showPrompt ? content : undefined,
                prompt: showPrompt ? matchPrompt : undefined
            };
        }

        function displayMatchResult(matchData) {
            const scoreClass = getScoreClass(matchData.score);
            const scoreIcon = getScoreIcon(matchData.score);
            
            const matrixHtml = matchData.matrix && matchData.matrix.length > 0 ? renderMatrix(matchData.matrix) : '';
            
            const html = `
                <div class="section">
                    <h3>üìä Match Results</h3>
                    <div class="match-score ${scoreClass}">
                        ${scoreIcon} ${matchData.score}%
                    </div>
                    
                    ${matrixHtml}
                    
                    <div class="result success">
<strong>‚úÖ Strengths:</strong>
${matchData.strengths.map(s => `‚Ä¢ ${s}`).join('\n')}

<strong>‚ùå Gaps:</strong>
${matchData.gaps.map(g => `‚Ä¢ ${g}`).join('\n')}

<strong>üí° Recommendations:</strong>
${matchData.recommendations.map(r => `‚Ä¢ ${r}`).join('\n')}

<strong>ü§î Analysis:</strong>
${matchData.reasoning}

<strong>üìà Test Metadata:</strong>
‚Ä¢ Model: ${matchData.model}
‚Ä¢ Response Time: ${matchData.responseTime}ms
‚Ä¢ Estimated Cost: $${matchData.estimatedCost}
‚Ä¢ Token Usage: ${matchData.usage.prompt_tokens} + ${matchData.usage.completion_tokens} = ${matchData.usage.total_tokens}
                    </div>
                    
                    ${matchData.rawResponse ? `
                        <details>
                            <summary>Show Raw AI Response</summary>
                            <div class="result">${matchData.rawResponse}</div>
                        </details>
                    ` : ''}
                    
                    ${matchData.prompt ? `
                        <details>
                            <summary>Show AI Prompt</summary>
                            <div class="result">${matchData.prompt}</div>
                        </details>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
        }

        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 70) return 'score-good';
            if (score >= 50) return 'score-moderate';
            if (score >= 30) return 'score-weak';
            return 'score-poor';
        }

        function getScoreIcon(score) {
            if (score >= 90) return 'üü¢';
            if (score >= 70) return 'üîµ';
            if (score >= 50) return 'üü°';
            if (score >= 30) return 'üü†';
            return 'üî¥';
        }

        function renderMatrix(matrix) {
            if (!matrix || !Array.isArray(matrix) || matrix.length === 0) {
                return '';
            }
            
            function getMatchClass(matchLevel) {
                const levelMap = {
                    'strong': 'match-strong',
                    'exceeds': 'match-exceeds', 
                    'partial': 'match-partial',
                    'missing': 'match-missing'
                };
                return levelMap[matchLevel] || 'match-missing';
            }
            
            function getMatchIcon(matchLevel) {
                const iconMap = {
                    'strong': 'üü¢',
                    'exceeds': 'üîµ',
                    'partial': 'üü°', 
                    'missing': 'üî¥'
                };
                return iconMap[matchLevel] || '‚ö™';
            }
            
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            return `
            <div class="analysis-matrix">
                <h4>üìã Requirements vs Evidence Matrix</h4>
                <div class="matrix-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Job Requirement</th>
                                <th>Resume Evidence</th>
                                <th>Match Level</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${matrix.map(row => `
                                <tr>
                                    <td class="matrix-category">${escapeHtml(row.category || '')}</td>
                                    <td class="matrix-requirement">${escapeHtml(row.requirement || '')}</td>
                                    <td class="matrix-evidence">${escapeHtml(row.evidence || 'Not mentioned')}</td>
                                    <td class="matrix-match ${getMatchClass(row.matchLevel)}">
                                        ${getMatchIcon(row.matchLevel)} ${row.matchLevel || 'unknown'}
                                    </td>
                                    <td class="matrix-action">${escapeHtml(row.gapAction || '')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            `;
        }

        function showResult(message, type) {
            document.getElementById('results').innerHTML = `
                <div class="result ${type}">
                    ${message}
                </div>
            `;
        }
        
        // Load sample data on page load
        window.addEventListener('load', () => {
            loadSampleResume();
            loadSampleJob('frontend');
        });
    </script>
</body>
</html> 